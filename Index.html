<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Weibull Analytics Dashboard</title>
  
  <link rel="icon" type="image/png" href="https://iili.io/qKNddvV.md.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap');
    
    :root { 
      --font-fa: 'Vazirmatn', Tahoma, sans-serif; 
      --font-en: 'Inter', system-ui, sans-serif; 
      --font-mono: 'IBM Plex Mono', monospace;
    }

    body { 
      font-family: var(--font-en); 
      background-color: #f4f4f5; 
      background-image: linear-gradient(to right, #e4e4e7 1px, transparent 1px), linear-gradient(to bottom, #e4e4e7 1px, transparent 1px);
      background-size: 40px 40px; 
      color: #1e293b;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }
    
    html[lang="fa"] body { font-family: var(--font-fa); }

    .clean-card { 
      background: #ffffff; 
      border-radius: 0.75rem; 
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      border: 1px solid #e2e8f0; 
      transition: box-shadow 0.3s ease, transform 0.3s ease, border-color 0.3s ease;
    }
    
    /* Interactive Hover for KPI Cards */
    .hover-lift:hover { 
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -6px rgba(0, 0, 0, 0.04); 
      transform: translateY(-4px);
      border-color: #cbd5e1;
    }
    
    .drop-zone { 
      border: 1.5px dashed #cbd5e1; 
      background: #f8fafc; 
      transition: all 0.2s ease; 
    }
    .drop-zone.dragover { border-color: #2563eb; background-color: #eff6ff; }

    input:focus, select:focus { 
      outline: none; 
      border-color: #3b82f6; 
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15); 
    }
    
    .font-mono-num { font-family: var(--font-mono); font-variant-numeric: tabular-nums; }
    .math-symbol { font-family: 'Times New Roman', Times, serif; font-style: italic; font-weight: normal; font-size: 1.15em; text-transform: none; }

    .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

    .custom-scroll::-webkit-scrollbar { height: 6px; width: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
</head>
<body class="p-4 md:p-6 lg:p-8 flex flex-col min-h-screen">

  <div class="max-w-[1440px] mx-auto flex-grow w-full">
    
    <header class="mb-8 flex flex-col md:flex-row items-start md:items-center justify-between gap-6 bg-white/95 backdrop-blur-md px-6 py-5 rounded-xl shadow-sm border border-slate-200 sticky top-0 z-50">
      <div class="flex items-center gap-5">
        <div class="p-1 border border-slate-100 rounded-lg shadow-sm bg-white">
          <img src="https://iili.io/qKNddvV.md.png" alt="Logo" class="w-11 h-11 rounded object-cover">
        </div>
        <div>
          <h1 class="text-xl md:text-2xl font-bold text-slate-900 tracking-tight" data-i18n="appTitle">Weibull Analytics Dashboard</h1>
          <p class="text-slate-500 text-xs font-medium uppercase tracking-widest mt-1" data-i18n="appSubtitle">Reliability &amp; Life Data Analysis</p>
        </div>
      </div>
      
      <div class="flex items-center gap-4 w-full md:w-auto">
        
        <div class="flex items-center bg-slate-100 p-0.5 rounded-lg border border-slate-200">
          <button id="langEn" onclick="setLanguage('en')" class="px-3 py-1.5 text-xs font-semibold rounded-md bg-white text-slate-900 shadow-sm transition-all">EN</button>
          <button id="langFa" onclick="setLanguage('fa')" class="px-3 py-1.5 text-xs font-semibold rounded-md text-slate-500 hover:text-slate-900 transition-all">فا</button>
        </div>
      </div>
    </header>

    <div class="grid grid-cols-1 xl:grid-cols-12 gap-6 md:gap-8">
      <div class="space-y-4 xl:col-span-3 flex flex-col">
        <div class="clean-card p-5">
          <div class="flex justify-between items-center mb-5 border-b border-slate-100 pb-3">
            <h2 class="text-sm font-bold text-slate-800 uppercase tracking-wider flex items-center gap-2" data-i18n="step1">Data Ingestion</h2>
            <button onclick="loadSampleData()" class="text-[10px] bg-slate-100 hover:bg-slate-200 text-slate-600 px-2 py-1 rounded transition-colors font-semibold uppercase tracking-wider" data-i18n="sampleBtn">Load Sample</button>
          </div>
          
          <div id="dropZone" onclick="document.getElementById('fileInput').click()" class="drop-zone rounded-lg p-6 text-center cursor-pointer flex flex-col items-center justify-center group">
            <svg class="w-5 h-5 text-slate-400 mb-2 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
            <p class="text-[11px] text-slate-600 font-semibold uppercase tracking-wider" data-i18n="dropText">Upload Dataset</p>
            <input id="fileInput" type="file" onchange="handleFileChange(event)" accept=".xlsx, .xls, .csv" class="hidden">
          </div>

          <div class="mt-3 p-3 bg-blue-50/50 border border-blue-100/60 rounded-md">
            <p class="text-[9px] text-blue-800 font-medium leading-relaxed" data-i18n="formatGuide"><strong>Format Guide:</strong> Include headers in row 1. Time must be numeric. Status: 1 (Fail/Event) or 0 (Censored/Running).</p>
          </div>

          <div id="previewContainer" class="hidden mt-4 animate-fade-in">
            <div class="overflow-x-auto rounded border border-slate-200 max-h-[160px] overflow-y-auto bg-white custom-scroll">
              <table class="min-w-full text-[10px] text-slate-600 font-mono-num" id="previewTable">
                <thead class="bg-slate-50 sticky top-0 border-b border-slate-200" id="previewHead"></thead>
                <tbody id="previewBody" class="divide-y divide-slate-100"></tbody>
              </table>
            </div>
            <p id="dataSummary" class="text-[10px] font-semibold text-slate-500 mt-2 text-center"></p>
          </div>
        </div>

        <div class="clean-card p-5">
          <div class="flex justify-between items-center mb-5 border-b border-slate-100 pb-3">
            <h2 class="text-sm font-bold text-slate-800 uppercase tracking-wider flex items-center gap-2" data-i18n="step2">Model Parameters</h2>
          </div>
          
          <div class="space-y-4 mb-6">
            <div>
              <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-1.5" data-i18n="timeCol">Time Array</label>
              <select id="timeColSelect" class="w-full px-3 py-2 border border-slate-200 rounded-md bg-slate-50 text-xs font-medium focus:bg-white transition-colors disabled:opacity-50" disabled=""><option value="" data-i18n="selectWait">Pending...</option></select>
            </div>
            <div>
              <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-1.5" data-i18n="eventCol">Event Status</label>
              <select id="indColSelect" class="w-full px-3 py-2 border border-slate-200 rounded-md bg-slate-50 text-xs font-medium focus:bg-white transition-colors disabled:opacity-50" disabled=""><option value="" data-i18n="selectWait">Pending...</option></select>
            </div>
            <div>
              <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-1.5" data-i18n="statusMode">Boolean Logic</label>
              <select id="statusMode" class="w-full px-3 py-2 border border-slate-200 rounded-md bg-slate-50 text-xs font-medium focus:bg-white transition-colors">
                <option value="auto" selected="" data-i18n="optAuto">Auto-detect</option>
                <option value="event" data-i18n="optEvent">Failure Event (1)</option>
                <option value="censor" data-i18n="optCensor">Right-Censored (1)</option>
              </select>
            </div>
            <div class="pt-2">
              <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-1.5" data-i18n="estMethod">Estimation Algorithm</label>
              <select id="methodSelect" class="w-full px-3 py-2 border border-slate-200 rounded-md bg-white text-xs font-semibold text-blue-700 shadow-sm focus:ring-1 focus:ring-blue-500">
                <option value="mle" selected="" data-i18n="mle">Maximum Likelihood (MLE)</option>
                <option value="mrr" data-i18n="mrr">Median Rank Regression (MRR)</option>
              </select>
              <p class="text-[9px] text-slate-400 mt-2 leading-tight" data-i18n="estHelp">MLE is recommended for n > 30. MRR is optimal for small sample sizes.</p>
            </div>
          </div>

          <button id="runBtn" onclick="runCalculation()" disabled="" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-4 rounded-md transition-all shadow-sm focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 disabled:bg-slate-200 disabled:text-slate-400 uppercase tracking-widest text-[11px]">
            <span data-i18n="runBtn">Compute Parameters</span>
          </button>

          <div id="setupError" class="hidden mt-4 text-[11px] text-red-600 bg-red-50 p-3 rounded-md border border-red-100 font-medium animate-fade-in"></div>
        </div>

        <div class="mt-auto pt-4">
          <a href="https://www.linkedin.com/in/mr-qaderi" target="_blank" class="clean-card p-4 flex items-center gap-4 bg-white hover:bg-slate-50 transition-colors group cursor-pointer block">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-slate-100 text-slate-400 group-hover:bg-[#0077b5] group-hover:text-white transition-all duration-300 shadow-sm">
              <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg>
            </div>
            <div class="flex flex-col">
              <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-0.5" data-i18n="devBy">System Architect</span>
              <span class="text-xs font-bold text-slate-800 group-hover:text-[#0077b5] transition-colors" dir="ltr">MohammadReza Qaderi</span>
              <span class="text-[10px] text-slate-500 font-medium mt-0.5" data-i18n="jobTitle">Business &amp; Systems Analyst</span>
            </div>
          </a>
        </div>
      </div>

      <div id="resultsContainer" class="xl:col-span-9 flex flex-col gap-6 md:gap-8 hidden">
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="clean-card hover-lift p-5 relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-1 h-full bg-slate-800"></div>
            <p class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mb-1 pl-2" data-i18n="betaTitle">Shape Parameter (<span class="math-symbol">β</span>)</p>
            <h3 id="valBeta" class="text-3xl font-mono-num font-semibold text-slate-900 pl-2 mt-1" dir="ltr">-</h3>
            <p id="ciBeta" class="text-xs font-mono-num font-medium text-slate-500 mt-1 pl-2" dir="ltr"></p>
            <div class="mt-3 pt-3 border-t border-slate-100 pl-2">
              <span id="insightBeta" class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-slate-100 text-slate-600" data-i18n="betaSub">Failure Mode</span>
            </div>
          </div>
          <div class="clean-card hover-lift p-5 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-blue-600"></div>
            <p class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mb-1 pl-2" data-i18n="etaTitle">Scale Parameter (<span class="math-symbol">η</span>)</p>
            <h3 id="valEta" class="text-3xl font-mono-num font-semibold text-slate-900 pl-2 mt-1" dir="ltr">-</h3>
            <p id="ciEta" class="text-xs font-mono-num font-medium text-slate-500 mt-1 pl-2" dir="ltr"></p>
            <div class="mt-3 pt-3 border-t border-slate-100 pl-2">
              <p class="text-[10px] text-slate-500 uppercase tracking-wider" data-i18n="etaSub">Characteristic Life (~63.2%)</p>
            </div>
          </div>
          <div class="clean-card hover-lift p-5 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-teal-600"></div>
            <p class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mb-1 pl-2" data-i18n="mtbfTitle">Mean Life (MTTF)</p>
            <h3 id="valMTBF" class="text-3xl font-mono-num font-semibold text-slate-900 pl-2 mt-1" dir="ltr">-</h3>
            <p class="text-xs font-mono-num text-transparent mt-1 pl-2">-</p>
            <div class="mt-3 pt-3 border-t border-slate-100 pl-2">
              <p class="text-[10px] text-slate-500 uppercase tracking-wider" data-i18n="mtbfSub">Expected Value (E[T])</p>
            </div>
          </div>
          <div class="clean-card hover-lift p-5 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-amber-500"></div>
            <p class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mb-1 pl-2" data-i18n="b10Title">B10 Life</p>
            <h3 id="valB10" class="text-3xl font-mono-num font-semibold text-slate-900 pl-2 mt-1" dir="ltr">-</h3>
            <p class="text-xs font-mono-num text-transparent mt-1 pl-2">-</p>
            <div class="mt-3 pt-3 border-t border-slate-100 pl-2">
              <p class="text-[10px] text-slate-500 uppercase tracking-wider" data-i18n="b10Sub">10% Probability of Failure</p>
            </div>
          </div>
        </div>

        <div class="clean-card overflow-hidden">
          <div class="bg-slate-50 px-5 py-3 border-b border-slate-200">
            <h3 class="text-xs font-bold text-slate-800 uppercase tracking-widest flex items-center gap-2">
              <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
              <span data-i18n="predictiveTitle">Predictive Analytics Panel</span>
            </h3>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-slate-100">
            <div class="p-6">
              <p class="text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-4" data-i18n="calcTitle">Survival Probability Projection</p>
              <div class="flex items-center gap-5">
                <div class="flex-grow">
                  <label class="block text-[10px] text-slate-400 mb-1 font-mono-num" data-i18n="inputTime">t = Operating Time</label>
                  <input type="number" id="calcTimeInput" oninput="updateCalculator()" class="w-full px-3 py-2 border-b-2 border-slate-200 bg-slate-50 rounded-t-md font-mono-num text-sm text-slate-800 focus:border-blue-600 focus:bg-blue-50/30 transition-colors" dir="ltr" placeholder="0.0">
                </div>
                <div class="text-slate-300 transform rtl:-scale-x-100">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                </div>
                <div class="flex-grow text-right md:text-center">
                  <p class="text-[10px] font-semibold text-slate-400 uppercase tracking-wider mb-1" data-i18n="outRel">R(t)</p>
                  <p id="calcResultR" class="text-2xl font-mono-num font-semibold text-slate-800" dir="ltr">-</p>
                </div>
              </div>
            </div>
            <div class="p-6">
              <p class="text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-4" data-i18n="targetLifeTitle">B-Life Expectancy / Replacement</p>
              <div class="flex items-center gap-5">
                <div class="flex-grow">
                  <label class="block text-[10px] text-slate-400 mb-1 font-mono-num" data-i18n="targetRelInput">R(t)% = Target Rel.</label>
                  <input type="number" id="calcRelInput" oninput="updateCalculator()" placeholder="90.0" max="99.99" min="0.01" class="w-full px-3 py-2 border-b-2 border-slate-200 bg-slate-50 rounded-t-md font-mono-num text-sm text-slate-800 focus:border-blue-600 focus:bg-blue-50/30 transition-colors" dir="ltr">
                </div>
                <div class="text-slate-300 transform rtl:-scale-x-100">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                </div>
                <div class="flex-grow text-right md:text-center">
                  <p class="text-[10px] font-semibold text-slate-400 uppercase tracking-wider mb-1" data-i18n="outTime">Allowed t</p>
                  <p id="calcResultT" class="text-2xl font-mono-num font-semibold text-slate-800" dir="ltr">-</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
          <div class="clean-card p-5 flex flex-col min-h-[340px]">
            <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
              <h2 class="text-[11px] font-semibold text-slate-700 uppercase tracking-widest" data-i18n="probPlotTitle">Weibull Probability Plot</h2>
              <button onclick="downloadChartImage('probChart', 'Weibull_Probability')" class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-slate-800 transition-colors" data-i18n-title="chartDlTooltip" title="Export Chart (PNG)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button>
            </div>
            <div class="flex-grow relative w-full h-full"><canvas id="probChart"></canvas></div>
          </div>
          <div class="clean-card p-5 flex flex-col min-h-[340px]">
            <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
              <h2 class="text-[11px] font-semibold text-slate-700 uppercase tracking-widest" data-i18n="cdfPlotTitle">Unreliability F(t) / CDF</h2>
              <button onclick="downloadChartImage('cdfChart', 'Weibull_CDF')" class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-slate-800 transition-colors" data-i18n-title="chartDlTooltip" title="Export Chart (PNG)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button>
            </div>
            <div class="flex-grow relative w-full h-full"><canvas id="cdfChart"></canvas></div>
          </div>
          <div class="clean-card p-5 flex flex-col min-h-[340px]">
            <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
              <h2 class="text-[11px] font-semibold text-slate-700 uppercase tracking-widest" data-i18n="chart1Title">Probability Density f(t)</h2>
              <button onclick="downloadChartImage('pdfChart', 'Weibull_PDF')" class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-slate-800 transition-colors" data-i18n-title="chartDlTooltip" title="Export Chart (PNG)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button>
            </div>
            <div class="flex-grow relative w-full h-full"><canvas id="pdfChart"></canvas></div>
          </div>
          <div class="clean-card p-5 flex flex-col min-h-[340px]">
            <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
              <h2 class="text-[11px] font-semibold text-slate-700 uppercase tracking-widest" data-i18n="chart2Title">Hazard Rate h(t)</h2>
              <button onclick="downloadChartImage('hazardChart', 'Weibull_Hazard_Rate')" class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-slate-800 transition-colors" data-i18n-title="chartDlTooltip" title="Export Chart (PNG)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button>
            </div>
            <div class="flex-grow relative w-full h-full"><canvas id="hazardChart"></canvas></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const translations = {
      en: {
        appTitle: "Weibull Analytics Dashboard", appSubtitle: "Reliability & Life Data Analysis",
        step1: "Data Ingestion", sampleBtn: "Load Sample", dropText: "Upload Dataset", selectWait: "Pending...",
        formatGuide: "<strong>Format Guide:</strong> Include headers in row 1. Time must be numeric. Status: 1 (Fail/Event) or 0 (Censored/Running).",
        step2: "Model Parameters", timeCol: "Time Array", eventCol: "Event Status",
        statusMode: "Boolean Logic", optAuto: "Auto-detect", optEvent: "Failure Event (1)", optCensor: "Right-Censored (1)",
        estMethod: "Estimation Algorithm", mle: "Maximum Likelihood (MLE)", mrr: "Median Rank Regression (MRR)",
        estHelp: "MLE is recommended for n > 30. MRR is optimal for small sample sizes.",
        runBtn: "Compute Parameters", 
        betaTitle: 'Shape Parameter (<span class="math-symbol">β</span>)', betaSub: "Failure Mode", 
        etaTitle: 'Scale Parameter (<span class="math-symbol">η</span>)', etaSub: "Characteristic Life (~63.2%)",
        mtbfTitle: "Mean Life (MTTF)", mtbfSub: "Expected Value (E[T])", b10Title: "B10 Life", b10Sub: "10% Probability of Failure",
        predictiveTitle: "Predictive Analytics Panel", calcTitle: "Survival Probability Projection", inputTime: "t = Operating Time", outRel: "R(t)",
        targetLifeTitle: "B-Life Expectancy / Replacement", targetRelInput: "R(t)% = Target Rel.", outTime: "Allowed t",
        probPlotTitle: "Weibull Probability Plot", cdfPlotTitle: "Unreliability F(t) / CDF",
        chart1Title: "Probability Density f(t)", chart2Title: "Hazard Rate h(t)",
        infantMortality: "Infant Mortality (Decreasing)", randomFailures: "Random (Constant Rate)", wearOut: "Wear-out (Increasing)",
        errSelectCols: "Column arrays must be distinct.", errPleaseSelect: "Please configure valid arrays.",
        errCalc: "Execution failed. Verify matrix formatting.", errInsufficientFailures: "Insufficient failure vectors for computation.",
        downloadBtn: "Export Tool", devBy: "System Architect", jobTitle: "Business & Systems Analyst", chartDlTooltip: "Export Chart (PNG)",
        ciPrefix: "90% CI: "
      },
      fa: {
        appTitle: "داشبورد تحلیلی وایبول", appSubtitle: "تحلیل پیشرفته قابلیت اطمینان و داده‌های عمر",
        step1: "ورودی داده‌ها", sampleBtn: "نمونه", dropText: "آپلود مجموعه داده", selectWait: "در انتظار...",
        formatGuide: "<strong>راهنمای فرمت:</strong> ردیف اول شامل عناوین باشد. زمان باید مقدار عددی باشد. وضعیت: ۱ (خرابی/رویداد) یا ۰ (سانسور/در حال کار).",
        step2: "پارامترهای مدل", timeCol: "آرایه زمان (t)", eventCol: "وضعیت رویداد",
        statusMode: "منطق بولی (Boolean)", optAuto: "تشخیص هوشمند", optEvent: "رویداد خرابی (۱)", optCensor: "داده‌های سانسور شده (۱)",
        estMethod: "الگوریتم تخمین", mle: "حداکثر درست‌نمایی (MLE)", mrr: "رگرسیون رتبه‌ای (MRR)",
        estHelp: "استفاده از MLE برای داده‌های زیاد (>۳۰) و MRR برای نمونه‌های کوچک پیشنهاد می‌شود.",
        runBtn: "اجرای محاسبات", 
        betaTitle: 'پارامتر شکل (<span class="math-symbol">β</span>)', betaSub: "مد خرابی", 
        etaTitle: 'پارامتر مقیاس (<span class="math-symbol">η</span>)', etaSub: "عمر مشخصه (۶۳.۲٪)",
        mtbfTitle: "عمر متوسط (MTTF)", mtbfSub: "ارزش مورد انتظار (E[T])", b10Title: "شاخص B10 Life", b10Sub: "احتمال ۱۰٪ خرابی",
        predictiveTitle: "پنل تحلیل و پیش‌بینی", calcTitle: "پیش‌بینی احتمال بقا (Survival)", inputTime: "زمان کارکرد = t", outRel: "R(t)",
        targetLifeTitle: "تخمین عمر هدف (تعویض/PM)", targetRelInput: "R(t) هدف = %", outTime: "زمان مجاز (t)",
        probPlotTitle: "نمودار احتمال وایبول (Probability Plot)", cdfPlotTitle: "توزیع تجمعی خرابی F(t)",
        chart1Title: "چگالی احتمال f(t)", chart2Title: "نرخ خطر h(t)",
        infantMortality: "مرگ زودرس (نرخ کاهشی)", randomFailures: "خرابی تصادفی (نرخ ثابت)", wearOut: "فرسودگی (نرخ افزایشی)",
        errSelectCols: "آرایه‌های ستون باید متفاوت باشند.", errPleaseSelect: "لطفا آرایه‌های معتبر را پیکربندی کنید.",
        errCalc: "خطا در پردازش. فرمت ماتریس داده‌ها بررسی شود.", errInsufficientFailures: "بردارهای خرابی کافی برای پردازش وجود ندارد.",
        downloadBtn: "خروجی ابزار", devBy: "معمار سیستم", jobTitle: "تحلیل‌گر سیستم و کسب‌و‌کار", chartDlTooltip: "اکسپورت نمودار (PNG)",
        ciPrefix: "بازه ۹۰٪: "
      }
    };

    let currentLang = 'en', currentRawData = [], currentFit = null;
    let probChartInst = null, cdfChartInst = null, pdfChartInst = null, hazChartInst = null;
    let cleanTimes = [], cleanEvents = [], probPlotData = [];

    // --- Math & Stats Core ---
    function gammaFunc(z) {
      const g = 7, p = [0.99999999999980993, 676.5203681218851, -1259.1392167224028, 771.32342877765313, -176.61502916214059, 12.507343278686905, -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
      if (z < 0.5) return Math.PI / (Math.sin(Math.PI * z) * gammaFunc(1 - z));
      z -= 1; let x = p[0]; for (let i = 1; i < g + 2; i++) x += p[i] / (z + i);
      let t = z + g + 0.5; return Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x;
    }

    function profileLogLik(beta, norm_t, e) {
      let nE = 0, sumL = 0; 
      for (let i = 0; i < e.length; i++) { if (e[i]) { nE++; sumL += Math.log(norm_t[i]); } }
      let A = 0; for (let i = 0; i < norm_t.length; i++) A += Math.pow(norm_t[i], beta);
      const eta = Math.pow(A / nE, 1 / beta);
      const ll = nE * Math.log(beta) - nE * beta * Math.log(eta) + (beta - 1) * sumL - nE;
      return { ll, eta };
    }
    
    function goldenSectionMax(f, a, b) {
      const invphi = (Math.sqrt(5) - 1) / 2;
      let c = b - invphi * (b - a), d = a + invphi * (b - a);
      for(let i=0; i<80; i++) { if (f(c) < f(d)) { a = c; c = d; d = a + invphi * (b - a); } else { b = d; d = c; c = b - invphi * (b - a); } }
      return (a + b) / 2;
    }

    function calculateMRR(t, e) {
      let data = t.map((time, idx) => ({ time, fail: e[idx] })).sort((a, b) => a.time - b.time);
      let n = data.length, prevAdjRank = 0, points = [];
      for(let i=0; i<n; i++) {
        if(data[i].fail) {
          let nbc = n - 1 - i;
          let rankInc = (n + 1 - prevAdjRank) / (1 + nbc);
          let adjRank = prevAdjRank + rankInc;
          prevAdjRank = adjRank;
          let medRank = (adjRank - 0.3) / (n + 0.4);
          let x = Math.log(data[i].time);
          let y = Math.log(-Math.log(1 - medRank));
          points.push({x, y, t: data[i].time, F: medRank});
        }
      }
      if(points.length < 2) throw new Error("Insufficient");
      
      let sumX=0, sumY=0, sumXY=0, sumXX=0, k=points.length;
      points.forEach(p => { sumX+=p.x; sumY+=p.y; sumXY+=p.x*p.y; sumXX+=p.x*p.x; });
      let m = (k*sumXY - sumX*sumY) / (k*sumXX - sumX*sumX);
      let c = (sumY - m*sumX) / k;
      
      return { beta: m, eta: Math.exp(-c/m), plotData: points };
    }

    function calculateBounds(beta, eta, r) {
      if(r < 3) return null;
      let varBeta = 0.608 * Math.pow(beta, 2) / r;
      let varEta = 1.109 * Math.pow(eta / beta, 2) / r;
      let z = 1.645; 
      let bLow = beta * Math.exp(-z * Math.sqrt(varBeta)/beta);
      let bHigh = beta * Math.exp(z * Math.sqrt(varBeta)/beta);
      let eLow = eta * Math.exp(-z * Math.sqrt(varEta)/eta);
      let eHigh = eta * Math.exp(z * Math.sqrt(varEta)/eta);
      return { beta: [bLow, bHigh], eta: [eLow, eHigh] };
    }

    function isRowAFail(val, headerName, mode) {
      if (val === null || val === undefined || val === "") return false;
      const s = String(val).toLowerCase().trim();
      const h = String(headerName).toLowerCase();
      const isAff = ["1","y","yes","true","t","fail","failed","broken","بله","خراب","+"].includes(s) || (parseFloat(s)>0);
      const isNeg = ["0","n","no","false","f","running","good","healthy","خیر","سالم","-"].includes(s) || (parseFloat(s)===0);
      if (mode === "event") return isAff;
      if (mode === "censor") return isNeg;
      if (h.includes("censor") || h.includes("سانسور") || h.includes("suspension") || h.includes("running") || h.includes("تعلیق")) return isNeg; 
      return isAff;
    }

    window.handleFileChange = async function(ev) {
      const f = ev.target.files[0]; if(!f) return;
      try {
        const buf = await f.arrayBuffer(), wb = XLSX.read(buf, { type: "array" });
        const ws = wb.Sheets[wb.SheetNames[0]], rows = XLSX.utils.sheet_to_json(ws, { header: 1, defval: null });
        currentRawData = rows.filter(r => r && r.some(c => c !== null));
        if (currentRawData.length < 2) return;
        
        let headers = currentRawData[0];
        const tS = document.getElementById("timeColSelect"), iS = document.getElementById("indColSelect");
        tS.innerHTML = ""; iS.innerHTML = "";
        tS.disabled = false; iS.disabled = false; document.getElementById("runBtn").disabled = false;
        
        headers.forEach((h, i) => { const n = h || `Col ${i+1}`; tS.add(new Option(n, i)); iS.add(new Option(n, i)); });
        
        document.getElementById("resultsContainer").classList.add("hidden");
        document.getElementById('dropZone').querySelector('p').innerHTML = `<span class="text-blue-600 font-bold">Loaded:</span> ${f.name}`;
        
        const head = document.getElementById("previewHead"), body = document.getElementById("previewBody");
        document.getElementById("previewContainer").classList.remove("hidden");
        head.innerHTML = "<tr>" + headers.map(x => `<th class="px-3 py-2 text-left tracking-wider uppercase">${x || '-'}</th>`).join("") + "</tr>";
        body.innerHTML = currentRawData.slice(1, 6).map(x => `<tr>` + headers.map((_, i) => `<td class="px-3 py-2">${x[i] !== null ? x[i] : ''}</td>`).join("") + `</tr>`).join("");
      } catch (e) { console.error(e); }
    }

    window.loadSampleData = function() {
      const mock = [["Unit_ID", "Operating_Hours", "Fail_Status"], ["P-101A", 2500, "0"], ["P-101B", 3200, "0"], ["P-102A", 4000, "1"], ["P-102B", 4200, "1"], ["P-103A", 4800, "1"], ["P-103B", 5500, "1"], ["P-104A", 6000, "0"]];
      const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(mock), "Dataset");
      handleFileChange({ target: { files: [new File([XLSX.write(wb, { type: 'array', bookType: 'xlsx' })], "Sample_Data_Set.xlsx")] } });
    };

    window.runCalculation = function() {
      const tIdx = Number(document.getElementById("timeColSelect").value);
      const iIdx = Number(document.getElementById("indColSelect").value);
      const mode = document.getElementById("statusMode").value;
      const method = document.getElementById("methodSelect").value;
      const errEl = document.getElementById("setupError");
      errEl.classList.add("hidden");

      if (tIdx === iIdx) { errEl.textContent = translations[currentLang].errSelectCols; errEl.classList.remove("hidden"); return; }

      let times = [], events = [], rCount = 0;
      for (let i = 1; i < currentRawData.length; i++) {
        const row = currentRawData[i]; if (!row) continue;
        let tStr = String(row[tIdx] || "").replace(/,/g, '');
        let t = parseFloat(tStr);
        if (isNaN(t) || t <= 0) continue; 
        
        let isFail = isRowAFail(row[iIdx], currentRawData[0][iIdx], mode);
        times.push(t); events.push(isFail);
        if(isFail) rCount++;
      }

      if (rCount < 2) { errEl.textContent = translations[currentLang].errInsufficientFailures; errEl.classList.remove("hidden"); return; }
      
      document.getElementById('dataSummary').textContent = `n=${times.length} (Failures: ${rCount}, Suspensions: ${times.length - rCount})`;

      try {
        let beta, eta;
        probPlotData = [];
        
        if(method === 'mrr') {
          let res = calculateMRR(times, events);
          beta = res.beta; eta = res.eta; probPlotData = res.plotData;
        } else {
          const tMax = Math.max(...times), nTimes = times.map(t => t / tMax);
          beta = goldenSectionMax((b) => profileLogLik(b, nTimes, events).ll, 0.05, 60.0);
          eta = profileLogLik(beta, nTimes, events).eta * tMax;
          probPlotData = calculateMRR(times, events).plotData; 
        }

        currentFit = { beta, eta }; cleanTimes = times; cleanEvents = events;
        let bounds = calculateBounds(beta, eta, rCount);
        
        document.getElementById("valBeta").textContent = beta.toFixed(4);
        document.getElementById("valEta").textContent = eta.toFixed(2);
        document.getElementById("valMTBF").textContent = (eta * gammaFunc(1 + 1/beta)).toFixed(2);
        document.getElementById("valB10").textContent = (eta * Math.pow(-Math.log(0.9), 1/beta)).toFixed(2);

        const ciPre = translations[currentLang].ciPrefix;
        document.getElementById("ciBeta").textContent = bounds ? `${ciPre}[${bounds.beta[0].toFixed(3)} - ${bounds.beta[1].toFixed(3)}]` : " ";
        document.getElementById("ciEta").textContent = bounds ? `${ciPre}[${bounds.eta[0].toFixed(1)} - ${bounds.eta[1].toFixed(1)}]` : " ";

        const inEl = document.getElementById("insightBeta"), tl = translations[currentLang];
        if (beta < 0.95) { inEl.textContent = tl.infantMortality; inEl.className = "inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-red-50 text-red-600"; }
        else if (beta <= 1.05) { inEl.textContent = tl.randomFailures; inEl.className = "inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-blue-50 text-blue-600"; }
        else { inEl.textContent = tl.wearOut; inEl.className = "inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-emerald-50 text-emerald-600"; }

        document.getElementById("resultsContainer").classList.remove("hidden");
        
        if(document.getElementById("calcTimeInput").value) updateCalculator();
        if(document.getElementById("calcRelInput").value) updateCalculator();

        renderCharts(times, events, eta, beta);

      } catch (e) {
        console.error(e);
        errEl.textContent = translations[currentLang].errCalc; errEl.classList.remove("hidden");
      }
    };

    window.updateCalculator = function() {
      if (!currentFit) return;
      const tIn = parseFloat(document.getElementById("calcTimeInput").value);
      const rIn = parseFloat(document.getElementById("calcRelInput").value);
      
      const resR = document.getElementById("calcResultR");
      const resT = document.getElementById("calcResultT");

      if (!isNaN(tIn) && tIn >= 0) {
        const p = Math.exp(-Math.pow(tIn / currentFit.eta, currentFit.beta)) * 100;
        resR.textContent = p.toFixed(2) + "%";
        resR.className = p >= 70 ? "text-2xl font-mono-num font-semibold text-emerald-600" : (p >= 50 ? "text-2xl font-mono-num font-semibold text-amber-500" : "text-2xl font-mono-num font-semibold text-red-600");
      } else { resR.textContent = "-"; resR.className = "text-2xl font-mono-num font-semibold text-slate-800"; }

      if (!isNaN(rIn) && rIn > 0 && rIn < 100) {
        const R = rIn / 100;
        const targetT = currentFit.eta * Math.pow(-Math.log(R), 1/currentFit.beta);
        resT.textContent = targetT.toFixed(2);
      } else { resT.textContent = "-"; }
    };

    const chartTooltipConfig = {
      backgroundColor: 'rgba(15, 23, 42, 0.95)', 
      titleFont: { family: "'IBM Plex Mono', monospace", size: 12 }, 
      bodyFont: { family: "'IBM Plex Mono', monospace", size: 11 },
      padding: 12, cornerRadius: 6, displayColors: false,
      borderWidth: 1, borderColor: 'rgba(255,255,255,0.1)'
    };

    function renderCharts(times, events, eta, beta) {
      const xMax = Math.max(...times) * 1.2;
      const fontUI = currentLang === 'fa' ? "'Vazirmatn'" : "'Inter'";
      const fontMono = "'IBM Plex Mono', monospace";
      
      Chart.defaults.font.family = fontUI;
      Chart.defaults.color = '#64748b';
      
      const gridOpt = { color: '#f1f5f9', tickColor: 'transparent' };
      
      const commonOpt = { 
        responsive: true, 
        maintainAspectRatio: false, 
        interaction: { mode: 'index', intersect: false },
        plugins: { legend: { display: false }, tooltip: chartTooltipConfig } 
      };

      // 1. Probability Plot
      const probCtx = document.getElementById('probChart').getContext('2d');
      if(probChartInst) probChartInst.destroy();
      
      let xMinPlot = Math.min(...times.filter((t,i)=>events[i])) * 0.8 || 1;
      let fitLine = [
         { x: xMinPlot, y: Math.log(-Math.log(1 - (1 - Math.exp(-Math.pow(xMinPlot/eta, beta))))) },
         { x: xMax, y: Math.log(-Math.log(1 - (1 - Math.exp(-Math.pow(xMax/eta, beta))))) }
      ];
      
      const pTicks = [0.01, 0.05, 0.1, 0.2, 0.3, 0.5, 0.7, 0.9, 0.95, 0.99];
      const pVals = pTicks.map(p => Math.log(-Math.log(1 - p)));

      probChartInst = new Chart(probCtx, {
        type: 'scatter',
        data: {
          datasets: [
            { label: 'Data', data: probPlotData.map(p=>({x: p.t, y: p.y})), backgroundColor: '#2563eb', pointRadius: 4, pointHoverRadius: 6 },
            { label: 'Fit', data: fitLine, type: 'line', borderColor: '#0f172a', borderWidth: 2, pointRadius: 0, fill: false, borderDash: [5, 5] }
          ]
        },
        options: {
          ...commonOpt,
          interaction: { mode: 'nearest', intersect: true },
          scales: {
            x: { type: 'logarithmic', title: { display: true, text: 'Time (t)', font: {size: 11} }, grid: gridOpt, ticks: {font: {family: fontMono}} },
            y: { 
              type: 'linear', title: { display: true, text: 'Probability F(t) %', font: {size: 11} }, grid: gridOpt,
              min: Math.log(-Math.log(1 - 0.005)), max: Math.log(-Math.log(1 - 0.995)),
              ticks: { font: {family: fontMono}, callback: function(val) {
                  let closest = pVals.reduce((prev, curr) => Math.abs(curr - val) < Math.abs(prev - val) ? curr : prev);
                  if(Math.abs(val - closest) < 0.1) return (pTicks[pVals.indexOf(closest)] * 100) + '%';
                  return '';
              } }
            }
          }
        }
      });

      // 2. CDF Plot
      const cdfCtx = document.getElementById('cdfChart').getContext('2d');
      if(cdfChartInst) cdfChartInst.destroy();
      let cdfData = [];
      for(let i=0; i<=100; i++) {
        let t = (i/100)*xMax;
        cdfData.push({x: t, y: 1 - Math.exp(-Math.pow(t/eta, beta))});
      }
      cdfChartInst = new Chart(cdfCtx, {
        type: 'line',
        data: { datasets: [{ label: 'CDF', data: cdfData, borderColor: '#0284c7', backgroundColor: 'rgba(2, 132, 199, 0.1)', fill: true, pointRadius: 0, tension: 0.3, borderWidth: 2 }] },
        options: { ...commonOpt, scales: { 
          x: { type: 'linear', max: xMax, grid: gridOpt, ticks: {font: {family: fontMono}} }, 
          y: { min: 0, max: 1, grid: gridOpt, ticks: { font: {family: fontMono}, callback: v => (v*100)+'%' } } 
        } }
      });

      // 3. PDF & Histogram
      const pdfCtx = document.getElementById('pdfChart').getContext('2d');
      if(pdfChartInst) pdfChartInst.destroy();
      let pdfData = [], hist = new Array(10).fill(0), binW = xMax/10;
      let fails = times.filter((_,i)=>events[i]);
      fails.forEach(t => hist[Math.min(9, Math.floor(t/binW))]++);
      let histData = hist.map((c,i) => ({x: (i+0.5)*binW, y: fails.length ? c/(fails.length*binW) : 0}));
      for(let i=0; i<=100; i++) {
        let t = Math.max(1e-5, (i/100)*xMax);
        pdfData.push({x: t, y: (beta/eta)*Math.pow(t/eta, beta-1)*Math.exp(-Math.pow(t/eta, beta))});
      }
      pdfChartInst = new Chart(pdfCtx, {
        type: 'line',
        data: { datasets: [
          { label: 'PDF', data: pdfData, borderColor: '#0f172a', borderWidth: 2, pointRadius: 0, tension: 0.4 },
          { label: 'Hist', data: histData, type: 'bar', backgroundColor: 'rgba(148, 163, 184, 0.3)', hoverBackgroundColor: 'rgba(100, 116, 139, 0.5)', borderRadius: 2, barPercentage: 0.95, categoryPercentage: 1 }
        ]},
        options: { ...commonOpt, scales: { x: { type: 'linear', max: xMax, grid: gridOpt, ticks: {font: {family: fontMono}} }, y: { beginAtZero: true, grid: gridOpt, ticks: {font: {family: fontMono}} } } }
      });

      // 4. Hazard Rate
      const hazCtx = document.getElementById('hazardChart').getContext('2d');
      if(hazChartInst) hazChartInst.destroy();
      let hazData = [];
      for(let i=0; i<=100; i++) {
        let t = Math.max(1e-5, (i/100)*xMax);
        let h = (beta/eta)*Math.pow(t/eta, beta-1);
        hazData.push({x: t, y: h > 10 ? null : h});
      }
      let hColor = beta < 0.95 ? '#dc2626' : (beta > 1.05 ? '#059669' : '#0f172a');
      hazChartInst = new Chart(hazCtx, {
        type: 'line',
        data: { datasets: [{ label: 'Rate', data: hazData, borderColor: hColor, backgroundColor: hColor+'1A', fill: true, pointRadius: 0, tension: 0.4, borderWidth: 2 }] },
        options: { ...commonOpt, scales: { x: { type: 'linear', max: xMax, grid: gridOpt, ticks: {font: {family: fontMono}} }, y: { beginAtZero: true, grid: gridOpt, ticks: {font: {family: fontMono}} } } }
      });
    }

    window.downloadChartImage = (id, name) => {
      const c = document.getElementById(id), t = document.createElement('canvas');
      t.width = c.width; t.height = c.height; const ctx = t.getContext('2d');
      ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, t.width, t.height); ctx.drawImage(c, 0, 0);
      const a = document.createElement('a'); a.download = name + '.png'; a.href = t.toDataURL('image/png'); a.click();
    };

    window.setLanguage = function(l) {
      currentLang = l; document.documentElement.lang = l; document.documentElement.dir = l === 'fa' ? 'rtl' : 'ltr';
      document.querySelectorAll('[data-i18n]').forEach(el => { if(translations[l][el.getAttribute('data-i18n')]) el.innerHTML = translations[l][el.getAttribute('data-i18n')]; });
      document.querySelectorAll('[data-i18n-title]').forEach(el => { if(translations[l][el.getAttribute('data-i18n-title')]) el.title = translations[l][el.getAttribute('data-i18n-title')]; });
      
      const lEn = document.getElementById('langEn'), lFa = document.getElementById('langFa');
      if (l === 'fa') {
        lFa.className = "px-3 py-1.5 text-xs font-semibold rounded-md bg-white text-slate-900 shadow-sm transition-all";
        lEn.className = "px-3 py-1.5 text-xs font-semibold rounded-md text-slate-500 hover:text-slate-900 transition-all";
      } else {
        lEn.className = "px-3 py-1.5 text-xs font-semibold rounded-md bg-white text-slate-900 shadow-sm transition-all";
        lFa.className = "px-3 py-1.5 text-xs font-semibold rounded-md text-slate-500 hover:text-slate-900 transition-all";
      }
      if(currentFit) runCalculation(); 
    }

    setLanguage('en'); 
  </script>

</body>
</html>
